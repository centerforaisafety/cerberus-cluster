## Nix

To install the Nix package manager run the install_nix.yml playbook.

To remove the Nix package manager run the uninstall_nix.yml playbook.

Both playbooks are idempotent. If you get an error running the uninstall_nix.yml playbook rerun the playbook. 

## Notifications
To install notifications run the notifications_install.yml and enter the slack_bot_token from the [slack bot app](https://app.slack.com/app-settings/T04PVJTPVCJ/A05AGQ7HNBX) (OAuth & Permissions -> OAuth Tokens for Your Workspace -> Bot User OAuth Token). Followed by the app password for the notification email (do-not-reply@safe.ai). This is generated by the following steps:
1. Enable 2fa for the account [https://myaccount.google.com/security](https://myaccount.google.com/security). Make sure you select the do-not-reply account on the login screen or change to it in the top right corner.
1. Now go to: [https://myaccount.google.com/apppasswords](https://myaccount.google.com/apppasswords). Again ensure you are on the correct account.
1. Press the "select app" dropdown and select "other". Then enter any name you like such as "CAIS Notifications". This will only be used here but should be recognizable.
1. Press "Generate" in the bottom right and copy this password (Copy this into terminal window when prompted).
1. PRESS DONE!

For the webhooks go to [slack bot app](https://app.slack.com/app-settings/T04PVJTPVCJ/A05AGQ7HNBX) then Incoming Webhooks. Press Add new Webhook to Workspace at the bottom and select the channel you want notified for admin notifications. Copy the webhook and enter it when prompted during the above install

To uninstall notifications run notifications_uninstall.yml. Note that this does not remove the MailProg entry from the slurm.conf. This won't cause problems but will be silently erroring in the slurmctld.log. So if you want to be clean you can remove that from the config.

# Billing

If the billing system has been deployed a final step needs to be performed before usage data will be collected. The cluster resource usage collection scripts in `/etc/oci-hpc/billing` need to be scheduled in crontab. Each collection script has certain requirements that need to be met before they can be used. More details can be found by reviewing the scripts or by running the scripts with the `-h` or `--help` options. Once the requirements have been satisfied, uncomment the entries in `crontab -e` to begin collecting usage data. 

## Passwordless SSH for Root User

We provide playbooks to enable and disable passwordless SSH for the root user. This feature is typically required for automated administrative tasks such as software upgrades, for example with Weka. Caution: Enabling passwordless SSH for the root user poses significant security risks. Be sure to disable it as soon as it is no longer necessary.

Prerequisites:
- Ensure that SSH key pairs (root and root.pub) are created. If you havenâ€™t already, you can generate them using the following command: `ssh-keygen -f /home/ubuntu/.ssh/root -N ''`
- Place the keys in the /home/ubuntu/.ssh/ directory.

Enabling Passwordless SSH: `ansible-playbook passwordless_ssh_for_root_enable.yml`

Disabling Passwordless SSH: `ansible-playbook passwordless_ssh_for_root_disable.yml`

Note: Always ensure that passwordless SSH is disabled when not actively needed to maintain the security integrity of your system.
